---
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";

const sections = [
  // {
  // 	id: "recently-added",
  // 	title: "Recently added",
  // 	updated: "1w ago",
  // 	showRss: false,
  // 	items: [
  // 	],
  // },
  {
    id: "apps",
    title: "Apps and Services",
    items: [],
  },
  {
    id: "peripherals",
    title: "Peripherals",
    items: [
      {
        category: "Peripherals",
        name: "Razor Orochi v2",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
      {
        category: "Peripherals",
        name: "Logitech G PRO X Superlight 2 SE",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
      {
        category: "Peripherals",
        name: "Samson Q2U",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
      {
        category: "Peripherals",
        name: "Nothing Ear (3)",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
      {
        category: "Peripherals",
        name: "Keychron K2 HE",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
      {
        category: "Peripherals",
        name: "Keychron V3 TKL",
        image: "https://placehold.co/200x200/f5f5f5/999?text=+",
      },
    ],
  },
  {
    id: "home",
    title: "Home",
    items: [],
  },
  {
    id: "audio",
    title: "Audio",
    items: [],
  },
  {
    id: "utility",
    title: "Utility",
    items: [],
  },
  {
    id: "photography",
    title: "Photography",
    items: [],
  },
  {
    id: "bouldering",
    title: "Bouldering",
    items: [],
  },
  {
    id: "car",
    title: "Car",
    items: [],
  },

  {
    id: "bags",
    title: "Bags",
    items: [],
  },

  {
    id: "perfumes",
    title: "Perfumes",
    items: [],
  },
  {
    id: "analog",
    title: "Analog",
    items: [],
  },
  {
    id: "travel",
    title: "Travel",
    items: [],
  },
  {
    id: "archive",
    title: "Archive",
    items: [],
  },
];
---

<Layout title="Gadgets" activeId="Gadgets">
  <div class="gear-page">	
    <header class="gear-hero">
      <h1 class="gear-title">Gadgets</h1>
      <p class="gear-subheader">
        Things I like and use for work, travel, hobbies, and more.
      </p>
      <p class="gear-description">
        I stole this idea from <a href="https://paulstamatiou.com/gear">Paul Stamatiou's website</a> lol. I thought it was a neat idea to keep track of what I like and enjoy using.
      </p>
    </header>

    <!-- Optional: hero image with caption -->
    <figure class="gear-hero-image">
      <img
        src="https://placehold.co/800x450/f5f5f5/999?text=Desk+setup"
        alt="Desk setup"
        width="800"
        height="450"
      />
      <figcaption>
        Scuffed setup with<a href="#">minimal desk space</a>.
      </figcaption>
    </figure>

    <div class="gear-card">
      {
        sections.map((section) => (
          <section
            class="gear-section"
            aria-labelledby={`section-${section.id}`}
          >
            <header class="gear-section-header">
              <div class="gear-section-title-row">
                <h2 id={`section-${section.id}`} class="gear-section-title">
                  {section.title}
                </h2>
                {section.showRss && (
                  <a
                    href="/rss.xml"
                    class="gear-rss-pill"
                    aria-label="RSS feed"
                  >
                    RSS
                  </a>
                )}
                <div class="gear-carousel-controls">
                  <button
                    type="button"
                    class="gear-section-scroll gear-scroll-prev"
                    aria-label="Previous 4 cards"
                  >
                    <Icon
                      name="heroicons-solid:chevron-left"
                      class="gear-chevron"
                    />
                  </button>
                  <button
                    type="button"
                    class="gear-section-scroll gear-scroll-next"
                    aria-label="Next 4 cards"
                  >
                    <Icon
                      name="heroicons-solid:chevron-right"
                      class="gear-chevron"
                    />
                  </button>
                </div>
              </div>
              {section.updated && (
                <p class="gear-section-updated">
                  Updated {section.updated} ago
                </p>
              )}
            </header>
            <div class="gear-row-viewport not-prose">
              <div class="gear-row">
                {section.items.map((item) => (
                  <a href="#" class="gear-item">
                    <div class="gear-item-image-wrap">
                      <img
                        src={item.image}
                        alt=""
                        width="200"
                        height="200"
                        class="gear-item-image"
                      />
                    </div>
                    <p class="gear-item-label">
                      {section.id === "recently-added" && (
                        <span class="gear-item-category">{item.category}</span>
                      )}
                      <span class="gear-item-name">{item.name}</span>
                    </p>
                  </a>
                ))}
              </div>
            </div>
          </section>
        ))
      }
    </div>
  </div>
</Layout>

<script>
  function getScrollAmount(row: HTMLElement): number {
    const viewport = row.parentElement;
    return viewport ? viewport.clientWidth : 0;
  }

  function updateButtons(section: HTMLElement) {
    const row = section.querySelector(".gear-row");
    const prevBtn = section.querySelector(".gear-scroll-prev");
    const nextBtn = section.querySelector(".gear-scroll-next");
    if (!row || !prevBtn || !nextBtn) return;
    const maxScroll = row.scrollWidth - row.clientWidth;
    (prevBtn as HTMLButtonElement).disabled = row.scrollLeft <= 0;
    (nextBtn as HTMLButtonElement).disabled = row.scrollLeft >= maxScroll - 1;
  }

  document.querySelectorAll(".gear-section").forEach((section) => {
    const row = section.querySelector(".gear-row") as HTMLElement;
    if (!row) return;

    section
      .querySelector(".gear-scroll-prev")
      ?.addEventListener("click", () => {
        const amount = getScrollAmount(row);
        row.scrollBy({ left: -amount, behavior: "smooth" });
        setTimeout(() => updateButtons(section as HTMLElement), 400);
      });

    section
      .querySelector(".gear-scroll-next")
      ?.addEventListener("click", () => {
        const amount = getScrollAmount(row);
        row.scrollBy({ left: amount, behavior: "smooth" });
        setTimeout(() => updateButtons(section as HTMLElement), 400);
      });

    row.addEventListener("scroll", () => updateButtons(section as HTMLElement));
    updateButtons(section as HTMLElement);
  });
</script>
